<div class="game-hero">
  <div class="game-card">
    <header class="game-header">
      <a routerLink="/" class="back-btn" aria-label="Back to home">‚Üê</a>
      <span class="header-title">Tripod</span>
      <div class="header-actions">
        <app-past-date-selector [iconOnly]="true" (dateSelected)="onDateChosen($event)"></app-past-date-selector>
        <button class="icon-btn" (click)="showPast = true" aria-label="Show past submissions">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
        </button>
      </div>
    </header>

    <app-triangle
      [submitted]="submitted"
      [letters]="currentLetters"
      [category]="currentCategory"
      [aggregatedCorrect]="aggregatedCorrectLetters"
      [aggregatedValidation]="aggregatedValidation"
      [allWrong]="allWrong"
      (valuesChanged)="onValuesChanged($event)"
      (valuesSubmitted)="onValuesSubmitted($event)"
      [resetCounter]="resetCounter"
    ></app-triangle>

    <div class="action-row">
      <app-submit-button [shake]="submitShake" (submit)="onSubmit()"></app-submit-button>
      <app-reset-button (reset)="onReset()"></app-reset-button>
    </div>
  </div>
</div>

<app-past-submissions
  *ngIf="showPast"
  [submissions]="filteredSubmissions"
  [letters]="currentLetters"
  (close)="showPast = false"
></app-past-submissions>

<div
  class="congrats-modal"
  *ngIf="congratsOpen"
  (click)="congratsOpen = false"
  tabindex="0"
>
  <!-- Confetti pieces -->
  <div class="confetti-container">
    <div class="confetti" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]"></div>
  </div>

  <div class="congrats-content" (click)="$event.stopPropagation()">
    <div class="trophy">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="#FFD700" stroke="#DAA520" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
        <path d="M4 22h16"></path>
        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
      </svg>
    </div>
    <h2>Congratulations!</h2>
    <p class="solve-message">You solved the puzzle!</p>
    <p class="attempts-stat">
      Solved in <span class="attempt-count">{{ filteredSubmissions.length }}</span>
      {{ filteredSubmissions.length === 1 ? 'attempt' : 'attempts' }}
    </p>
    <button (click)="congratsOpen = false" class="primary">Close</button>
  </div>
</div>
