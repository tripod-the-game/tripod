<div class="game-hero">
  <div class="game-card">
    <header class="game-header">
      <a routerLink="/" class="back-btn" aria-label="Back to home">‚Üê</a>
      <span class="header-title">Tripod</span>
      <div class="header-actions">
        <app-past-date-selector [iconOnly]="true" (dateSelected)="onDateChosen($event)"></app-past-date-selector>
        <button class="icon-btn" (click)="showPast = true" aria-label="Show past submissions">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
        </button>
        <button class="icon-btn" [class.shake]="revealShake" (click)="onRevealClick()" aria-label="Reveal answer">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
    </header>

    <app-triangle
      [submitted]="submitted"
      [letters]="currentLetters"
      [category]="currentCategory"
      [size]="currentSize"
      [aggregatedCorrect]="aggregatedCorrectLetters"
      [aggregatedValidation]="aggregatedValidation"
      [allWrong]="allWrong"
      (valuesChanged)="onValuesChanged($event)"
      (valuesSubmitted)="onValuesSubmitted($event)"
      [resetCounter]="resetCounter"
    ></app-triangle>

    <div class="action-row">
      <app-submit-button [shake]="submitShake" (submit)="onSubmit()"></app-submit-button>
      <app-reset-button [shake]="resetShake" (reset)="onReset()"></app-reset-button>
    </div>
  </div>
</div>

<app-past-submissions
  *ngIf="showPast"
  [submissions]="filteredSubmissions"
  [letters]="currentLetters"
  [size]="currentSize"
  (close)="showPast = false"
></app-past-submissions>

<div
  class="confirm-modal"
  *ngIf="showRevealConfirm"
  (click)="showRevealConfirm = false"
>
  <div class="confirm-content reveal-options" (click)="$event.stopPropagation()">
    <h2>Need Help?</h2>
    <p>Choose how much to reveal:</p>
    <div class="reveal-buttons">
      <button
        class="reveal-option hint-option"
        (click)="onRevealHint()"
        [disabled]="hintsRemaining === 0"
      >
        <span class="option-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7z"></path>
            <path d="M9 21h6"></path>
            <path d="M12 17v4"></path>
          </svg>
        </span>
        <span class="option-label">Reveal Letter</span>
        <span class="option-detail">{{ hintsRemaining }} hint{{ hintsRemaining === 1 ? '' : 's' }} left</span>
      </button>
      <button class="reveal-option reveal-all-option" (click)="onRevealAnswer()">
        <span class="option-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </span>
        <span class="option-label">Reveal All</span>
        <span class="option-detail">Show full answer</span>
      </button>
    </div>
    <button class="cancel-btn" (click)="showRevealConfirm = false">Cancel</button>
  </div>
</div>

<div
  class="confirm-modal"
  *ngIf="showLastHintConfirm"
  (click)="onCancelLastHint()"
>
  <div class="confirm-content last-hint-confirm" (click)="$event.stopPropagation()">
    <div class="warning-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7z"></path>
        <path d="M9 21h6"></path>
        <path d="M12 17v4"></path>
      </svg>
    </div>
    <h2>Last Letter!</h2>
    <p>This is your final unknown letter. Revealing it will end the game.</p>
    <div class="confirm-buttons">
      <button class="secondary" (click)="onCancelLastHint()">Cancel</button>
      <button class="primary warning" (click)="onConfirmLastHint()">Reveal & End Game</button>
    </div>
  </div>
</div>

<div
  class="congrats-modal"
  *ngIf="congratsOpen"
  (click)="congratsOpen = false"
>
  <!-- Confetti pieces -->
  <div class="confetti-container">
    <div class="confetti" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]"></div>
  </div>

  <div class="congrats-content" (click)="$event.stopPropagation()">
    <div class="trophy">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="#FFD700" stroke="#DAA520" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
        <path d="M4 22h16"></path>
        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
      </svg>
    </div>
    <h2>Congratulations!</h2>
    <p class="solve-message">You solved the puzzle!</p>
    <p class="attempts-stat">
      Solved in <span class="attempt-count">{{ filteredSubmissions.length }}</span>
      {{ filteredSubmissions.length === 1 ? 'attempt' : 'attempts' }}
    </p>
    <div class="congrats-buttons">
      <button (click)="onShare()" class="share-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
          <polyline points="16 6 12 2 8 6"></polyline>
          <line x1="12" y1="2" x2="12" y2="15"></line>
        </svg>
        {{ shareButtonText }}
      </button>
      <button (click)="congratsOpen = false" class="primary">Close</button>
    </div>
  </div>
</div>
